<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lab Picks - Divot Lab</title>
<link rel="icon" type="image/png" href="/favicon.png">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Cormorant+Garamond:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --black: #0A0A0A;
  --white: #FAFAFA;
  --graphite: #4A4A4A;
  --green: #1B4D3E;
  --green-light: #5BBF85;
  --blue: #2C5F7C;
  --blue-mid: #5A8FA8;
  --red: #D94848;
  --body: 'DM Sans', system-ui, sans-serif;
  --mono: 'JetBrains Mono', 'Courier New', monospace;
  --display: 'Cormorant Garamond', Georgia, serif;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: var(--body);
  background: var(--black);
  color: var(--white);
  min-height: 100vh;
}

/* LOGIN WALL */
#loginWall {
  position: fixed;
  inset: 0;
  background: var(--black);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}
#loginWall.hidden { display: none; }

.login-box {
  background: #111;
  border: 1px solid #1a1a1a;
  border-radius: 12px;
  padding: 48px 40px;
  max-width: 420px;
  width: 90%;
  text-align: center;
}
.login-logo {
  width: 48px;
  height: 48px;
  margin: 0 auto 24px;
  color: var(--green-light);
}
.login-title {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 8px;
  letter-spacing: -0.02em;
}
.login-subtitle {
  font-size: 14px;
  color: rgba(250,250,250,0.4);
  margin-bottom: 32px;
}
.login-input {
  width: 100%;
  background: rgba(250,250,250,0.05);
  border: 1px solid rgba(250,250,250,0.1);
  border-radius: 8px;
  padding: 14px 18px;
  font-family: var(--mono);
  font-size: 15px;
  color: var(--white);
  margin-bottom: 16px;
  transition: all 0.2s;
}
.login-input:focus {
  outline: none;
  border-color: var(--green-light);
  background: rgba(250,250,250,0.08);
}
.login-btn {
  width: 100%;
  background: linear-gradient(135deg, var(--green), var(--green-light));
  border: none;
  border-radius: 8px;
  padding: 14px;
  font-family: var(--body);
  font-size: 15px;
  font-weight: 600;
  color: white;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}
.login-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 8px 24px rgba(91,191,133,0.25);
}
.login-error {
  color: var(--red);
  font-size: 13px;
  margin-top: 12px;
  display: none;
}
.login-error.show { display: block; }

/* MAIN APP */
#app {
  display: none;
  padding: 24px;
  max-width: 1400px;
  margin: 0 auto;
}
#app.show { display: block; }

/* HEADER */
.app-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 32px;
  padding-bottom: 24px;
  border-bottom: 1px solid rgba(250,250,250,0.1);
}
.app-title {
  font-family: var(--body);
  font-size: 36px;
  font-weight: 600;
  letter-spacing: -.02em;
  line-height: 1.02;
}
.app-title span {
  color: var(--green-light);
  font-weight: 400;
}
.app-meta {
  display: flex;
  align-items: center;
  gap: 20px;
  font-size: 13px;
  color: rgba(250,250,250,0.5);
}
.refresh-btn {
  background: rgba(250,250,250,0.05);
  border: 1px solid rgba(250,250,250,0.1);
  border-radius: 6px;
  padding: 8px 16px;
  font-family: var(--body);
  font-size: 13px;
  font-weight: 500;
  color: var(--white);
  cursor: pointer;
  transition: all 0.2s;
}
.refresh-btn:hover {
  background: rgba(250,250,250,0.08);
  border-color: var(--green-light);
}

/* TABS */
.tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 24px;
  border-bottom: 1px solid rgba(250,250,250,0.1);
  padding-bottom: 2px;
}
.tab {
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  padding: 12px 20px;
  font-family: var(--body);
  font-size: 14px;
  font-weight: 500;
  color: rgba(250,250,250,0.5);
  cursor: pointer;
  transition: all 0.2s;
}
.tab:hover {
  color: rgba(250,250,250,0.8);
}
.tab.active {
  color: var(--green-light);
  border-bottom-color: var(--green-light);
}

/* TAB CONTENT */
.tab-content {
  display: none;
}
.tab-content.active {
  display: block;
}

/* LOADING */
.loading {
  text-align: center;
  padding: 60px 20px;
  color: rgba(250,250,250,0.4);
}

/* ALERT BOX */
.alert-box {
  margin-bottom: 24px;
  padding: 16px 20px;
  background: rgba(217,72,72,0.1);
  border: 1px solid rgba(217,72,72,0.3);
  border-radius: 8px;
  font-size: 14px;
  color: rgba(250,250,250,0.8);
}
.alert-box strong {
  color: var(--red);
  font-weight: 600;
}

/* VALUE TABLE */
.value-table {
  background: #111;
  border: 1px solid #1a1a1a;
  border-radius: 12px;
  overflow: hidden;
}
.value-table table {
  width: 100%;
  border-collapse: collapse;
}
.value-table thead {
  background: rgba(250,250,250,0.03);
  border-bottom: 1px solid rgba(250,250,250,0.1);
}
.value-table th {
  padding: 14px 16px;
  text-align: center;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: rgba(250,250,250,0.4);
}
.value-table tbody tr {
  border-bottom: 1px solid rgba(250,250,250,0.05);
  transition: background 0.15s;
}
.value-table tbody tr:hover {
  background: rgba(250,250,250,0.02);
}
.value-table tbody tr.high-value {
  background: rgba(91,191,133,0.05);
}
.value-table tbody tr.high-value:hover {
  background: rgba(91,191,133,0.08);
}
.value-table td {
  padding: 14px 16px;
  font-size: 14px;
}
.player-name {
  font-weight: 500;
  color: rgba(250,250,250,0.9);
}
.market-badge {
  display: inline-block;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}
.market-badge.win { background: rgba(91,191,133,0.15); color: var(--green-light); }
.market-badge.top5 { background: rgba(90,143,168,0.15); color: var(--blue-mid); }
.market-badge.top10 { background: rgba(90,143,168,0.12); color: var(--blue-mid); }
.market-badge.top20 { background: rgba(90,143,168,0.1); color: var(--blue-mid); }
.odds-cell {
  font-family: var(--mono);
  font-size: 13px;
  color: rgba(250,250,250,0.6);
}
.odds-cell.best {
  color: var(--green-light);
  font-weight: 600;
}
.odds-cell.dg {
  color: var(--blue-mid);
  font-weight: 600;
}
.edge-cell {
  font-family: var(--mono);
  font-size: 14px;
  font-weight: 600;
}
.edge-positive { color: var(--green-light); }
.edge-medium { color: var(--blue-mid); }
.confidence-badge {
  display: inline-block;
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 12px;
  font-weight: 600;
  text-align: center;
  min-width: 80px;
}
.confidence-badge.strong {
  background: rgba(91,191,133,0.15);
  color: var(--green-light);
  border: 1px solid rgba(91,191,133,0.3);
}
.confidence-badge.moderate {
  background: rgba(90,143,168,0.15);
  color: var(--blue-mid);
  border: 1px solid rgba(90,143,168,0.3);
}

/* STATS GRID */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}
.stat-card {
  background: #111;
  border: 1px solid #1a1a1a;
  border-radius: 12px;
  padding: 20px;
}
.stat-label {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: rgba(250,250,250,0.4);
  margin-bottom: 8px;
}
.stat-value {
  font-family: var(--mono);
  font-size: 28px;
  font-weight: 600;
  color: var(--green-light);
}

/* LIVE LEADERBOARD */
.leaderboard {
  background: #111;
  border: 1px solid #1a1a1a;
  border-radius: 12px;
  overflow: hidden;
  margin-top: 24px;
}
.leaderboard-header {
  padding: 20px;
  border-bottom: 1px solid rgba(250,250,250,0.1);
}
.leaderboard-header h3 {
  font-size: 18px;
  color: var(--green-light);
  margin-bottom: 4px;
}
.leaderboard-header p {
  font-size: 13px;
  color: rgba(250,250,250,0.5);
}
.leaderboard-table {
  max-height: 600px;
  overflow-y: auto;
  position: relative;
}
.leaderboard-row {
  display: grid;
  grid-template-columns: 60px 1fr 90px 100px 90px;
  padding: 14px 20px;
  border-bottom: 1px solid rgba(250,250,250,0.05);
  align-items: center;
  transition: background 0.15s;
}
.leaderboard-row:hover {
  background: rgba(250,250,250,0.02);
}
.leaderboard-row.header {
  position: sticky;
  top: 0;
  z-index: 10;
  background: #111;
  border-bottom: 1px solid rgba(250,250,250,0.1);
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: rgba(250,250,250,0.4);
}
.lb-pos {
  font-family: var(--mono);
  font-size: 16px;
  font-weight: 600;
  color: var(--green-light);
}
.lb-player {
  font-weight: 500;
}
.lb-score {
  font-family: var(--mono);
  font-size: 14px;
  font-weight: 600;
}
.lb-score.under { color: var(--green-light); }
.lb-score.over { color: var(--red); }
.lb-win-prob {
  font-family: var(--mono);
  font-size: 13px;
  color: rgba(250,250,250,0.6);
}

/* EMPTY STATE */
.empty-state {
  text-align: center;
  padding: 80px 20px;
  color: rgba(250,250,250,0.4);
}
.empty-icon {
  font-size: 64px;
  margin-bottom: 16px;
  opacity: 0.3;
}

@media (max-width: 768px) {
  #app { padding: 16px; }
  .app-header { flex-direction: column; align-items: flex-start; gap: 16px; }
  .tabs { overflow-x: auto; }
  .value-table { overflow-x: auto; }
  .stats-grid { grid-template-columns: 1fr; }
  .leaderboard-row { grid-template-columns: 50px 1fr 80px 85px 70px; padding: 12px 16px; font-size: 13px; }
}
</style>
</head>
<body>

<!-- LOGIN WALL -->
<div id="loginWall">
  <div class="login-box">
    <svg class="login-logo" viewBox="0 0 72 72" fill="none">
      <line x1="4" y1="36.5" x2="68" y2="36.5" stroke="currentColor" stroke-width="3.2"/>
      <path d="M10 36.5 C18 36.5,26 60.5,36 60.5 S54 36.5,62 36.5" fill="currentColor" fill-opacity=".15"/>
      <path d="M10 36.5 C18 36.5,26 60.5,36 60.5 S54 36.5,62 36.5" stroke="currentColor" stroke-width="2.8" fill="none"/>
      <circle cx="36" cy="20.5" r="9" fill="currentColor"/>
    </svg>
    <h1 class="login-title">Lab Picks</h1>
    <p class="login-subtitle">Private betting intelligence</p>
    <form id="loginForm">
      <input type="password" id="passwordInput" class="login-input" placeholder="Enter password" required>
      <button type="submit" class="login-btn">Access Lab Picks</button>
    </form>
    <div id="loginError" class="login-error">Invalid password</div>
  </div>
</div>

<!-- MAIN APP -->
<div id="app">
  <div class="app-header">
    <h1 class="app-title">Lab <span>Picks</span></h1>
    <div class="app-meta">
      <span id="lastUpdate">Loading...</span>
      <button class="refresh-btn" onclick="refreshData()">‚ü≥ Refresh</button>
    </div>
  </div>

  <!-- TABS -->
  <div class="tabs">
    <button class="tab active" data-tab="value-finder">Value Finder</button>
    <button class="tab" data-tab="live-tracker">Live Tracker</button>
  </div>

  <!-- TAB 1: VALUE FINDER -->
  <div id="value-finder" class="tab-content active">
    <div class="stats-grid" id="summaryStats">
      <div class="stat-card">
        <div class="stat-label">Total Value Bets</div>
        <div class="stat-value" id="totalBets">--</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Avg Edge</div>
        <div class="stat-value" id="avgEdge">--</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Strong Picks</div>
        <div class="stat-value" id="strongPicks">--</div>
      </div>
    </div>

    <div id="liveWarning"></div>

    <div id="valueTableContainer" class="loading">
      Finding value bets...
    </div>
  </div>

  <!-- TAB 2: LIVE TRACKER -->
  <div id="live-tracker" class="tab-content">
    <div id="liveContainer" class="loading">
      Loading live data...
    </div>
  </div>
</div>

<script>
const API_BASE = 'https://divotlab-api.vercel.app';
const MIN_EDGE_OUTRIGHT = 0.08; // 8%
const MIN_EDGE_STRONG = 0.15; // 15%

let authenticated = false;
let globalBettingData = null;
let isLiveTournament = false;
let liveTournamentName = '';

// ============================================
// HELPER FUNCTIONS
// ============================================

function decimalToAmerican(decimal) {
  if (decimal >= 2) {
    return '+' + Math.round((decimal - 1) * 100);
  } else {
    return Math.round(-100 / (decimal - 1));
  }
}

function formatOdds(decimal) {
  return decimalToAmerican(decimal);
}

// ============================================
// AUTHENTICATION
// ============================================

document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const password = document.getElementById('passwordInput').value;
  const errorEl = document.getElementById('loginError');
  
  try {
    const response = await fetch(`${API_BASE}/api/auth/lab-picks`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ password })
    });
    
    const data = await response.json();
    
    if (data.success) {
      authenticated = true;
      document.getElementById('loginWall').classList.add('hidden');
      document.getElementById('app').classList.add('show');
      loadAllData();
    } else {
      errorEl.classList.add('show');
      setTimeout(() => errorEl.classList.remove('show'), 3000);
    }
  } catch (error) {
    console.error('Auth error:', error);
    errorEl.textContent = 'Connection error';
    errorEl.classList.add('show');
  }
});

// ============================================
// TAB SWITCHING
// ============================================

document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    const targetTab = tab.dataset.tab;
    
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    
    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
    document.getElementById(targetTab).classList.add('active');
  });
});

// ============================================
// DATA LOADING
// ============================================

async function loadAllData() {
  try {
    await Promise.all([
      loadValueBets(),
      loadLiveData()
    ]);
    
    document.getElementById('lastUpdate').textContent = `Updated: ${new Date().toLocaleTimeString()}`;
  } catch (error) {
    console.error('Error loading data:', error);
  }
}

async function loadValueBets() {
  const container = document.getElementById('valueTableContainer');
  const warningContainer = document.getElementById('liveWarning');
  container.innerHTML = '<div class="loading">Finding value bets...</div>';
  warningContainer.innerHTML = '';
  
  try {
    const [win, top5, top10, top20] = await Promise.all([
      fetch(`${API_BASE}/api/betting-odds?tour=pga&market=win&odds_format=decimal`).then(r => r.json()),
      fetch(`${API_BASE}/api/betting-odds?tour=pga&market=top_5&odds_format=decimal`).then(r => r.json()),
      fetch(`${API_BASE}/api/betting-odds?tour=pga&market=top_10&odds_format=decimal`).then(r => r.json()),
      fetch(`${API_BASE}/api/betting-odds?tour=pga&market=top_20&odds_format=decimal`).then(r => r.json())
    ]);
    
    const valueBets = [];
    
    processMarket(win.data, 'win', valueBets);
    processMarket(top5.data, 'top5', valueBets);
    processMarket(top10.data, 'top10', valueBets);
    processMarket(top20.data, 'top20', valueBets);
    
    // Sort by edge (highest first)
    valueBets.sort((a, b) => b.edge - a.edge);
    
    // Smart filtering: Allow 2 extreme longshots, then filter to +5000 or better
    let filteredBets = [];
    let longshotCount = 0;
    const LONGSHOT_THRESHOLD = 750; // +75000 in decimal is 751
    const MAX_LONGSHOTS = 2;
    const ODDS_CUTOFF = 51; // +5000 in decimal is 51
    
    for (const bet of valueBets) {
      const american = decimalToAmerican(bet.bestOdds);
      const americanValue = parseInt(american.replace('+', ''));
      
      // If it's a massive longshot (>+75000)
      if (americanValue > 75000) {
        if (longshotCount < MAX_LONGSHOTS) {
          filteredBets.push(bet);
          longshotCount++;
        }
        // Skip other massive longshots after we have 2
      } else if (bet.bestOdds <= ODDS_CUTOFF) {
        // Include if odds are +5000 or better
        filteredBets.push(bet);
      }
    }
    
    // Take top 20 by edge
    filteredBets = filteredBets.slice(0, 20);
    
    globalBettingData = filteredBets;
    
    if (isLiveTournament) {
      warningContainer.innerHTML = `
        <div style="margin-bottom: 16px; padding: 16px; background: rgba(217,72,72,0.1); border: 1px solid rgba(217,72,72,0.3); border-radius: 8px; font-size: 13px; color: rgba(250,250,250,0.7); text-align: center;">
          <strong>‚ö† Tournament is Live:</strong> These odds may be stale. DG model uses historical fit during live play.
        </div>
      `;
    }
    
    renderValueTable(filteredBets);
    updateSummaryStats(filteredBets);
    
  } catch (error) {
    console.error('Error loading value bets:', error);
    container.innerHTML = '<div class="empty-state"><div class="empty-icon">‚ö†</div><p>Error loading betting data</p></div>';
  }
}

function processMarket(data, market, valueBets) {
  if (!data || !data.odds) return;
  
  if (data.notes && data.notes.includes('Tournament is live')) {
    isLiveTournament = true;
    liveTournamentName = data.event_name || 'Current tournament';
  }
  
  data.odds.forEach(player => {
    const dgOdds = player.datagolf?.baseline_history_fit;
    if (!dgOdds || dgOdds === null) return;
    
    const dgProb = 1 / dgOdds;
    
    const books = ['draftkings', 'fanduel', 'betmgm', 'pinnacle', 'bet365', 'caesars'];
    let bestOdds = 0;
    let bestBook = '';
    
    books.forEach(book => {
      if (player[book] && player[book] > bestOdds) {
        bestOdds = player[book];
        bestBook = book;
      }
    });
    
    if (bestOdds === 0) return;
    
    const edge = (dgProb * bestOdds) - 1;
    const edgePercent = edge * 100;
    
    if (edge < MIN_EDGE_OUTRIGHT) return;
    
    let confidence = 'moderate';
    if (edge >= MIN_EDGE_STRONG) confidence = 'strong';
    
    valueBets.push({
      player: player.player_name,
      market,
      dgOdds: dgOdds,
      dgOddsFormatted: formatOdds(dgOdds),
      bestOdds: bestOdds,
      bestOddsFormatted: formatOdds(bestOdds),
      bestBook,
      edge,
      edgePercent: edgePercent.toFixed(1),
      confidence
    });
  });
}

function renderValueTable(valueBets) {
  const container = document.getElementById('valueTableContainer');
  
  if (valueBets.length === 0) {
    if (isLiveTournament) {
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">üèåÔ∏è</div>
          <p><strong>Tournament is Live</strong></p>
          <p style="margin-top: 12px; font-size: 14px;">DataGolf baseline model is unavailable during live play.<br>Value betting is best done pre-tournament.</p>
        </div>
      `;
    } else {
      container.innerHTML = '<div class="empty-state"><div class="empty-icon">üí∞</div><p>No value bets found at current thresholds</p></div>';
    }
    return;
  }
  
  container.innerHTML = `
    <div class="value-table">
      <table>
        <thead>
          <tr>
            <th>Player</th>
            <th>Market</th>
            <th>DG Model Odds</th>
            <th>Best Book</th>
            <th>Book Odds</th>
            <th>Edge</th>
            <th>Confidence</th>
          </tr>
        </thead>
        <tbody>
          ${valueBets.map(bet => `
            <tr class="${bet.confidence === 'strong' ? 'high-value' : ''}">
              <td class="player-name">${bet.player}</td>
              <td><span class="market-badge ${bet.market}">${bet.market.toUpperCase()}</span></td>
              <td class="odds-cell dg">${bet.dgOddsFormatted}</td>
              <td class="odds-cell">${bet.bestBook.toUpperCase()}</td>
              <td class="odds-cell best">${bet.bestOddsFormatted}</td>
              <td class="edge-cell edge-${bet.confidence === 'strong' ? 'positive' : 'medium'}">+${bet.edgePercent}%</td>
              <td><span class="confidence-badge ${bet.confidence}">${bet.confidence.toUpperCase()}</span></td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  `;
}

function updateSummaryStats(valueBets) {
  const total = valueBets.length;
  const avgEdge = total > 0 ? valueBets.reduce((sum, bet) => sum + bet.edge, 0) / total : 0;
  const strong = valueBets.filter(bet => bet.confidence === 'strong').length;
  
  document.getElementById('totalBets').textContent = total;
  document.getElementById('avgEdge').textContent = total > 0 ? `${(avgEdge * 100).toFixed(1)}%` : '--';
  document.getElementById('strongPicks').textContent = strong;
}

async function loadLiveData() {
  const container = document.getElementById('liveContainer');
  
  try {
    // Fetch current betting odds (includes DG model probabilities)
    const response = await fetch(`${API_BASE}/api/betting-odds?tour=pga&market=win&odds_format=decimal`);
    const data = await response.json();
    
    if (!data.success || !data.data || !data.data.odds) {
      container.innerHTML = '<div class="empty-state"><div class="empty-icon">‚è≥</div><p>No tournament data available</p></div>';
      return;
    }
    
    const oddsData = data.data;
    const eventName = oddsData.event_name;
    const isLive = oddsData.notes && oddsData.notes.includes('Tournament is live');
    
    // Process odds to calculate implied probabilities and find value
    const players = oddsData.odds
      .filter(p => p.datagolf?.baseline_history_fit && p.datagolf.baseline_history_fit > 0)
      .map(p => {
        const dgOdds = p.datagolf.baseline_history_fit;
        const dgProb = (1 / dgOdds) * 100; // Convert to percentage
        
        // Find best book odds
        const books = ['draftkings', 'fanduel', 'betmgm', 'pinnacle', 'bet365', 'caesars'];
        let bestOdds = 0;
        let bestBook = '';
        
        books.forEach(book => {
          if (p[book] && p[book] > bestOdds) {
            bestOdds = p[book];
            bestBook = book;
          }
        });
        
        const bookImpliedProb = bestOdds > 0 ? (1 / bestOdds) * 100 : 0;
        const edgePercent = dgProb - bookImpliedProb;
        
        return {
          name: p.player_name,
          dgProb: dgProb,
          bestOdds: bestOdds,
          bestBook: bestBook,
          bookImpliedProb: bookImpliedProb,
          edge: edgePercent
        };
      })
      .sort((a, b) => b.dgProb - a.dgProb) // Sort by DG probability (highest first)
      .slice(0, 20);
    
    if (players.length === 0) {
      container.innerHTML = '<div class="empty-state"><div class="empty-icon">üèåÔ∏è</div><p>No betting data available</p></div>';
      return;
    }
    
    container.innerHTML = `
      <div style="margin-bottom: 16px; padding: 16px; background: rgba(91,191,133,0.1); border: 1px solid rgba(91,191,133,0.3); border-radius: 8px; font-size: 13px; color: rgba(250,250,250,0.7);">
        <span style="color: rgba(250,250,250,0.7);">üí° How to Use:</span> "Edge" shows the difference between DataGolf's win probability and the book's implied probability. Positive edge (green) means DG thinks the player has a better chance than the betting odds/books suggest.
        ${isLive ? '<br><br><span style="color: rgba(250,250,250,0.7);">‚ö† Live Tournament:</span> Odds update slower than play. Check current standings before placing bets.' : ''}
      </div>
      
      <div class="leaderboard">
        <div class="leaderboard-header">
          <h3>${eventName}</h3>
          <p>${isLive ? 'Live betting odds with Data Golf model probabilities' : 'Pre-tournament betting odds with Data Golf model probabilities'}</p>
        </div>
        <div class="leaderboard-table">
          <div class="leaderboard-row header">
            <div>Rank</div>
            <div>Player</div>
            <div>DG Win %</div>
            <div>Book Win %</div>
            <div>Edge</div>
          </div>
          ${players.map((player, i) => {
            const edgeClass = player.edge > 0 ? 'under' : player.edge < 0 ? 'over' : '';
            const edgeSign = player.edge > 0 ? '+' : '';
            
            return `
              <div class="leaderboard-row ${player.edge > 2 ? 'high-value' : ''}">
                <div class="lb-pos">${i + 1}</div>
                <div class="lb-player">${player.name}</div>
                <div class="lb-score">${player.dgProb.toFixed(1)}%</div>
                <div class="lb-win-prob">${player.bookImpliedProb.toFixed(1)}%</div>
                <div class="lb-score ${edgeClass}">${edgeSign}${player.edge.toFixed(1)}%</div>
              </div>
            `;
          }).join('')}
        </div>
      </div>
    `;
    
  } catch (error) {
    console.error('Live data error:', error);
    container.innerHTML = '<div class="empty-state"><div class="empty-icon">‚ö†</div><p>Error loading betting data</p></div>';
  }
}

function refreshData() {
  if (!authenticated) return;
  isLiveTournament = false;
  liveTournamentName = '';
  loadAllData();
}
</script>

</body>
</html>